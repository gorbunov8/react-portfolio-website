{"ast":null,"code":"import { __extends, __read, __spreadArray } from \"tslib\";\nimport { isFunction } from './util/isFunction';\nimport { isSubscription, Subscription } from './Subscription';\nimport { config } from './config';\nimport { reportUnhandledError } from './util/reportUnhandledError';\nimport { noop } from './util/noop';\nimport { nextNotification, errorNotification, COMPLETE_NOTIFICATION } from './NotificationFactories';\nimport { timeoutProvider } from './scheduler/timeoutProvider';\nimport { captureError } from './util/errorContext';\n\nvar Subscriber = function (_super) {\n  __extends(Subscriber, _super);\n\n  function Subscriber(destination) {\n    var _this = _super.call(this) || this;\n\n    _this.isStopped = false;\n\n    if (destination) {\n      _this.destination = destination;\n\n      if (isSubscription(destination)) {\n        destination.add(_this);\n      }\n    } else {\n      _this.destination = EMPTY_OBSERVER;\n    }\n\n    return _this;\n  }\n\n  Subscriber.create = function (next, error, complete) {\n    return new SafeSubscriber(next, error, complete);\n  };\n\n  Subscriber.prototype.next = function (value) {\n    if (this.isStopped) {\n      handleStoppedNotification(nextNotification(value), this);\n    } else {\n      this._next(value);\n    }\n  };\n\n  Subscriber.prototype.error = function (err) {\n    if (this.isStopped) {\n      handleStoppedNotification(errorNotification(err), this);\n    } else {\n      this.isStopped = true;\n\n      this._error(err);\n    }\n  };\n\n  Subscriber.prototype.complete = function () {\n    if (this.isStopped) {\n      handleStoppedNotification(COMPLETE_NOTIFICATION, this);\n    } else {\n      this.isStopped = true;\n\n      this._complete();\n    }\n  };\n\n  Subscriber.prototype.unsubscribe = function () {\n    if (!this.closed) {\n      this.isStopped = true;\n\n      _super.prototype.unsubscribe.call(this);\n\n      this.destination = null;\n    }\n  };\n\n  Subscriber.prototype._next = function (value) {\n    this.destination.next(value);\n  };\n\n  Subscriber.prototype._error = function (err) {\n    try {\n      this.destination.error(err);\n    } finally {\n      this.unsubscribe();\n    }\n  };\n\n  Subscriber.prototype._complete = function () {\n    try {\n      this.destination.complete();\n    } finally {\n      this.unsubscribe();\n    }\n  };\n\n  return Subscriber;\n}(Subscription);\n\nexport { Subscriber };\n\nvar SafeSubscriber = function (_super) {\n  __extends(SafeSubscriber, _super);\n\n  function SafeSubscriber(observerOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n\n    var next;\n\n    if (isFunction(observerOrNext)) {\n      next = observerOrNext;\n    } else if (observerOrNext) {\n      next = observerOrNext.next, error = observerOrNext.error, complete = observerOrNext.complete;\n      var context_1;\n\n      if (_this && config.useDeprecatedNextContext) {\n        context_1 = Object.create(observerOrNext);\n\n        context_1.unsubscribe = function () {\n          return _this.unsubscribe();\n        };\n      } else {\n        context_1 = observerOrNext;\n      }\n\n      next = next === null || next === void 0 ? void 0 : next.bind(context_1);\n      error = error === null || error === void 0 ? void 0 : error.bind(context_1);\n      complete = complete === null || complete === void 0 ? void 0 : complete.bind(context_1);\n    }\n\n    _this.destination = {\n      next: next ? wrapForErrorHandling(next, _this) : noop,\n      error: wrapForErrorHandling(error !== null && error !== void 0 ? error : defaultErrorHandler, _this),\n      complete: complete ? wrapForErrorHandling(complete, _this) : noop\n    };\n    return _this;\n  }\n\n  return SafeSubscriber;\n}(Subscriber);\n\nexport { SafeSubscriber };\n\nfunction wrapForErrorHandling(handler, instance) {\n  return function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    try {\n      handler.apply(void 0, __spreadArray([], __read(args)));\n    } catch (err) {\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        captureError(err);\n      } else {\n        reportUnhandledError(err);\n      }\n    }\n  };\n}\n\nfunction defaultErrorHandler(err) {\n  throw err;\n}\n\nfunction handleStoppedNotification(notification, subscriber) {\n  var onStoppedNotification = config.onStoppedNotification;\n  onStoppedNotification && timeoutProvider.setTimeout(function () {\n    return onStoppedNotification(notification, subscriber);\n  });\n}\n\nexport var EMPTY_OBSERVER = {\n  closed: true,\n  next: noop,\n  error: defaultErrorHandler,\n  complete: noop\n};","map":{"version":3,"mappings":"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","names":["isFunction","isSubscription","Subscription","config","reportUnhandledError","noop","nextNotification","errorNotification","COMPLETE_NOTIFICATION","timeoutProvider","captureError","__extends","destination","_super","_this","add","EMPTY_OBSERVER","Subscriber","next","error","complete","SafeSubscriber","value","isStopped","handleStoppedNotification","_next","err","_error","_complete","closed","unsubscribe","call","observerOrNext","context_1","useDeprecatedNextContext","Object","create","bind","wrapForErrorHandling","defaultErrorHandler","handler","instance","args","__spreadArray","useDeprecatedSynchronousErrorHandling","notification","subscriber","onStoppedNotification","setTimeout"],"sourceRoot":"","sources":["../../../src/internal/Subscriber.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}