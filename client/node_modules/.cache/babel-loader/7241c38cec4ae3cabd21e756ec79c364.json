{"ast":null,"code":"import { operate } from '../util/lift';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nimport { identity } from '../util/identity';\nexport function retry(configOrCount) {\n  if (configOrCount === void 0) {\n    configOrCount = Infinity;\n  }\n\n  var config;\n\n  if (configOrCount && typeof configOrCount === 'object') {\n    config = configOrCount;\n  } else {\n    config = {\n      count: configOrCount\n    };\n  }\n\n  var count = config.count,\n      _a = config.resetOnSuccess,\n      resetOnSuccess = _a === void 0 ? false : _a;\n  return count <= 0 ? identity : operate(function (source, subscriber) {\n    var soFar = 0;\n    var innerSub;\n\n    var subscribeForRetry = function () {\n      var syncUnsub = false;\n      innerSub = source.subscribe(new OperatorSubscriber(subscriber, function (value) {\n        if (resetOnSuccess) {\n          soFar = 0;\n        }\n\n        subscriber.next(value);\n      }, undefined, function (err) {\n        if (soFar++ < count) {\n          if (innerSub) {\n            innerSub.unsubscribe();\n            innerSub = null;\n            subscribeForRetry();\n          } else {\n            syncUnsub = true;\n          }\n        } else {\n          subscriber.error(err);\n        }\n      }));\n\n      if (syncUnsub) {\n        innerSub.unsubscribe();\n        innerSub = null;\n        subscribeForRetry();\n      }\n    };\n\n    subscribeForRetry();\n  });\n}","map":{"version":3,"mappings":"AACA,SAASA,OAAT,QAAwB,cAAxB;AAEA,SAASC,kBAAT,QAAmC,sBAAnC;AACA,SAASC,QAAT,QAAyB,kBAAzB;AAuDA,OAAM,SAAUC,KAAV,CAAmBC,aAAnB,EAAiE;EAA9C;IAAAA;EAA8C;;EACrE,IAAIC,MAAJ;;EACA,IAAID,aAAa,IAAI,OAAOA,aAAP,KAAyB,QAA9C,EAAwD;IACtDC,MAAM,GAAGD,aAAT;EACD,CAFD,MAEO;IACLC,MAAM,GAAG;MACPC,KAAK,EAAEF;IADA,CAAT;EAGD;;EACO,SAAK,GAA6BC,MAAM,MAAxC;EAAA,IAAOE,KAA2BF,MAAM,eAAxC;EAAA,IAAOG,cAAc,mBAAG,KAAH,GAAQD,EAA7B;EAER,OAAOD,KAAK,IAAI,CAAT,GACHJ,QADG,GAEHF,OAAO,CAAC,UAACS,MAAD,EAASC,UAAT,EAAmB;IACzB,IAAIC,KAAK,GAAG,CAAZ;IACA,IAAIC,QAAJ;;IACA,IAAMC,iBAAiB,GAAG;MACxB,IAAIC,SAAS,GAAG,KAAhB;MACAF,QAAQ,GAAGH,MAAM,CAACM,SAAP,CACT,IAAId,kBAAJ,CACES,UADF,EAEE,UAACM,KAAD,EAAM;QACJ,IAAIR,cAAJ,EAAoB;UAClBG,KAAK,GAAG,CAAR;QACD;;QACDD,UAAU,CAACO,IAAX,CAAgBD,KAAhB;MACD,CAPH,EASEE,SATF,EAUE,UAACC,GAAD,EAAI;QACF,IAAIR,KAAK,KAAKL,KAAd,EAAqB;UACnB,IAAIM,QAAJ,EAAc;YACZA,QAAQ,CAACQ,WAAT;YACAR,QAAQ,GAAG,IAAX;YACAC,iBAAiB;UAClB,CAJD,MAIO;YACLC,SAAS,GAAG,IAAZ;UACD;QACF,CARD,MAQO;UACLJ,UAAU,CAACW,KAAX,CAAiBF,GAAjB;QACD;MACF,CAtBH,CADS,CAAX;;MA0BA,IAAIL,SAAJ,EAAe;QACbF,QAAQ,CAACQ,WAAT;QACAR,QAAQ,GAAG,IAAX;QACAC,iBAAiB;MAClB;IACF,CAjCD;;IAkCAA,iBAAiB;EAClB,CAtCM,CAFX;AAyCD","names":["operate","OperatorSubscriber","identity","retry","configOrCount","config","count","_a","resetOnSuccess","source","subscriber","soFar","innerSub","subscribeForRetry","syncUnsub","subscribe","value","next","undefined","err","unsubscribe","error"],"sourceRoot":"","sources":["../../../../src/internal/operators/retry.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}