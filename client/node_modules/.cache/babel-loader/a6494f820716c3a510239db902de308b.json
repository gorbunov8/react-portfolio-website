{"ast":null,"code":"import { innerFrom } from '../observable/from';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nexport function mergeInternals(source, subscriber, project, concurrent, onBeforeNext, expand, innerSubScheduler, additionalTeardown) {\n  var buffer = [];\n  var active = 0;\n  var index = 0;\n  var isComplete = false;\n\n  var checkComplete = function () {\n    if (isComplete && !buffer.length && !active) {\n      subscriber.complete();\n    }\n  };\n\n  var outerNext = function (value) {\n    return active < concurrent ? doInnerSub(value) : buffer.push(value);\n  };\n\n  var doInnerSub = function (value) {\n    expand && subscriber.next(value);\n    active++;\n    var innerComplete = false;\n    innerFrom(project(value, index++)).subscribe(new OperatorSubscriber(subscriber, function (innerValue) {\n      onBeforeNext === null || onBeforeNext === void 0 ? void 0 : onBeforeNext(innerValue);\n\n      if (expand) {\n        outerNext(innerValue);\n      } else {\n        subscriber.next(innerValue);\n      }\n    }, function () {\n      innerComplete = true;\n    }, undefined, function () {\n      if (innerComplete) {\n        try {\n          active--;\n\n          var _loop_1 = function () {\n            var bufferedValue = buffer.shift();\n            innerSubScheduler ? subscriber.add(innerSubScheduler.schedule(function () {\n              return doInnerSub(bufferedValue);\n            })) : doInnerSub(bufferedValue);\n          };\n\n          while (buffer.length && active < concurrent) {\n            _loop_1();\n          }\n\n          checkComplete();\n        } catch (err) {\n          subscriber.error(err);\n        }\n      }\n    }));\n  };\n\n  source.subscribe(new OperatorSubscriber(subscriber, outerNext, function () {\n    isComplete = true;\n    checkComplete();\n  }));\n  return function () {\n    additionalTeardown === null || additionalTeardown === void 0 ? void 0 : additionalTeardown();\n  };\n}","map":{"version":3,"mappings":"AACA,SAASA,SAAT,QAA0B,oBAA1B;AAGA,SAASC,kBAAT,QAAmC,sBAAnC;AAeA,OAAM,SAAUC,cAAV,CACJC,MADI,EAEJC,UAFI,EAGJC,OAHI,EAIJC,UAJI,EAKJC,YALI,EAMJC,MANI,EAOJC,iBAPI,EAQJC,kBARI,EAQ2B;EAG/B,IAAMC,MAAM,GAAQ,EAApB;EAEA,IAAIC,MAAM,GAAG,CAAb;EAEA,IAAIC,KAAK,GAAG,CAAZ;EAEA,IAAIC,UAAU,GAAG,KAAjB;;EAKA,IAAMC,aAAa,GAAG;IAIpB,IAAID,UAAU,IAAI,CAACH,MAAM,CAACK,MAAtB,IAAgC,CAACJ,MAArC,EAA6C;MAC3CR,UAAU,CAACa,QAAX;IACD;EACF,CAPD;;EAUA,IAAMC,SAAS,GAAG,UAACC,KAAD,EAAS;IAAK,OAACP,MAAM,GAAGN,UAAT,GAAsBc,UAAU,CAACD,KAAD,CAAhC,GAA0CR,MAAM,CAACU,IAAP,CAAYF,KAAZ,CAA3C;EAA8D,CAA9F;;EAEA,IAAMC,UAAU,GAAG,UAACD,KAAD,EAAS;IAI1BX,MAAM,IAAIJ,UAAU,CAACkB,IAAX,CAAgBH,KAAhB,CAAV;IAIAP,MAAM;IAKN,IAAIW,aAAa,GAAG,KAApB;IAGAvB,SAAS,CAACK,OAAO,CAACc,KAAD,EAAQN,KAAK,EAAb,CAAR,CAAT,CAAmCW,SAAnC,CACE,IAAIvB,kBAAJ,CACEG,UADF,EAEE,UAACqB,UAAD,EAAW;MAGTlB,YAAY,SAAZ,gBAAY,WAAZ,GAAY,MAAZ,eAAY,CAAGkB,UAAH,CAAZ;;MAEA,IAAIjB,MAAJ,EAAY;QAGVU,SAAS,CAACO,UAAD,CAAT;MACD,CAJD,MAIO;QAELrB,UAAU,CAACkB,IAAX,CAAgBG,UAAhB;MACD;IACF,CAfH,EAgBE;MAGEF,aAAa,GAAG,IAAhB;IACD,CApBH,EAsBEG,SAtBF,EAuBE;MAIE,IAAIH,aAAJ,EAAmB;QAKjB,IAAI;UAIFX,MAAM;;;YAMJ,IAAMe,aAAa,GAAGhB,MAAM,CAACiB,KAAP,EAAtB;YAIAnB,iBAAiB,GAAGL,UAAU,CAACyB,GAAX,CAAepB,iBAAiB,CAACqB,QAAlB,CAA2B;cAAM,iBAAU,CAACH,aAAD,CAAV;YAAyB,CAA1D,CAAf,CAAH,GAAiFP,UAAU,CAACO,aAAD,CAA5G;;;UALF,OAAOhB,MAAM,CAACK,MAAP,IAAiBJ,MAAM,GAAGN,UAAjC,EAA2C;;UAM1C;;UAEDS,aAAa;QACd,CAlBD,CAkBE,OAAOgB,GAAP,EAAY;UACZ3B,UAAU,CAAC4B,KAAX,CAAiBD,GAAjB;QACD;MACF;IACF,CAtDH,CADF;EA0DD,CA1ED;;EA6EA5B,MAAM,CAACqB,SAAP,CACE,IAAIvB,kBAAJ,CAAuBG,UAAvB,EAAmCc,SAAnC,EAA8C;IAE5CJ,UAAU,GAAG,IAAb;IACAC,aAAa;EACd,CAJD,CADF;EAUA,OAAO;IACLL,kBAAkB,SAAlB,sBAAkB,WAAlB,GAAkB,MAAlB,qBAAkB,EAAlB;EACD,CAFD;AAGD","names":["innerFrom","OperatorSubscriber","mergeInternals","source","subscriber","project","concurrent","onBeforeNext","expand","innerSubScheduler","additionalTeardown","buffer","active","index","isComplete","checkComplete","length","complete","outerNext","value","doInnerSub","push","next","innerComplete","subscribe","innerValue","undefined","bufferedValue","shift","add","schedule","err","error"],"sourceRoot":"","sources":["../../../../src/internal/operators/mergeInternals.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}